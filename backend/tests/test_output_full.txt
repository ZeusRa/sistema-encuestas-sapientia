============================= test session starts ==============================
platform linux -- Python 3.12.7, pytest-9.0.2, pluggy-1.6.0 -- /usr/local/bin/python3.12
cachedir: .pytest_cache
rootdir: /app
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 2 items

tests/test_secuencias.py::test_insercion_con_prefijo_test FAILED         [ 50%]
tests/test_secuencias.py::test_verificar_secuencias_bd PASSED            [100%]

=================================== FAILURES ===================================
_______________________ test_insercion_con_prefijo_test ________________________

mock_admin = <MagicMock spec='UsuarioAdmin' id='136304777831216'>

    def test_insercion_con_prefijo_test(mock_admin):
        """
        1. Verifica que se pueda insertar un registro (Encuesta) con el nombre 'TEST ...'.
        2. Verifica que el ID generado sea válido.
        """
        payload = {
            "nombre": "TEST Encuesta de Verificación",
            "descripcion": "Encuesta creada por test automático para validar secuencias",
            "fecha_inicio": "2025-01-01T00:00:00",
            "fecha_fin": "2025-12-31T23:59:59",
            "prioridad": "opcional",
            "publico": "alumnos"
        }
    
        # Endpoint backend/app/routers/admin.py -> /admin/encuestas
        response = client.post("/admin/encuestas", json=payload)
    
>       assert response.status_code == 200, f"Error al crear encuesta: {response.text}"
E       AssertionError: Error al crear encuesta: {"detail":"Not authenticated"}
E       assert 401 == 200
E        +  where 401 = <Response [401 Unauthorized]>.status_code

tests/test_secuencias.py:48: AssertionError
=============================== warnings summary ===============================
app/database.py:40
  /app/app/database.py:40: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

../usr/local/lib/python3.12/site-packages/passlib/utils/__init__.py:854
  /usr/local/lib/python3.12/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
    from crypt import crypt as _crypt

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_secuencias.py::test_insercion_con_prefijo_test - AssertionE...
=================== 1 failed, 1 passed, 2 warnings in 12.68s ===================
